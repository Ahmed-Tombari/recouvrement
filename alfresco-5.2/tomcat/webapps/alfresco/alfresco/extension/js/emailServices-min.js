var FTL_EMAIL_WF_NOTIFICATION="/app:company_home/app:dictionary/app:email_templates/cm:recouvrement/cm:recouvrement_x0020_notification_fr.html.ftl";var FTL_EMAIL_WF_REMINDER="/app:company_home/app:dictionary/app:email_templates/cm:TAPM/cm:reminder_x0020_TAPM_fr.html.ftl";var FTL_EMAIL_WF_TACHE="/app:company_home/app:dictionary/app:email_templates/cm:recouvrement/cm:taches_x0020_recouvrement_fr.html.ftl";var EMAIL_FROM="bot@addinn-group.com";var SUBJECT_DOSSIER_REMINDER="[CIMA PROCESS DEMANDE DEROGATION] Rappel pour la validation";var SUBJECT_DOSSIER_RECU="[CIMA PROCESS DEMANDE DEROGATION] DOSSIER EN COURS";var SUBJECT_DOCUMENT_RECU="[CIMA PROCESS DEMANDE DEROGATION] R&eacute;ponse pour votre demande de d&eacute;rogation";var SUBJECT_DOSSIER_A_VALIDER="[CIMA PROCESS DEMANDE DEROGATION] Demande de validation du dossier de traitement d'achat PM";function sendMail(k,i,j,c){logger.system.out("SEND EMAIL Task name :"+task.name);logger.system.out("EMAIL TO :"+k);logger.system.out("EMAIL subject :"+i);logger.system.out("EMAIL FTL_EMAIL :"+j);logger.system.out("EMAIL toMany :"+c);var d=getDocument();logger.system.out("dossierIT: "+d);var l=d.getSiteShortName();var f=actions.create("mail");if(c){f.parameters.to_many=k;var a=people.getGroup(k);var b=people.getMembers(a,false);foreach(var e in b){logger.system.out("EMAIL TO member :"+e.properties["cm:email"])}}else{f.parameters.to=k}f.parameters.subject=i;f.parameters.from=EMAIL_FROM;f.parameters.ignore_send_failure=true;f.parameters.template=companyhome.childrenByXPath(j)[0];var g=new Array();g.workflowTitle=task.name;g.workflowPooled=c;g.workflowDescription=task.description;g.workflowId="activiti$"+task.id;g.numeroDossier=d.name;g.workflowInstanceId=execution.getVariable("workflowinstanceid");g.siteShortName=l;bpm_package.setScope(workflow.getScope());var h=new Array();h.args=g;f.parameters.template_model=h;f.executeAsynchronously(d);logger.system.out("SEND EMAIL END")}function sendNotification(k,i,j,c,d,m){logger.system.out("SEND EMAIL NOTIFICATION :");logger.system.out("EMAIL TO :"+k);logger.system.out("EMAIL subject :"+i);logger.system.out("EMAIL FTL_EMAIL :"+j);logger.system.out("EMAIL toMany :"+c);logger.system.out("dossierIT: "+d);var l=d.getSiteShortName();var f=actions.create("mail");if(c){f.parameters.to_many=k;var a=people.getGroup(k);var b=people.getMembers(a,false);foreach(var e in b){logger.system.out("EMAIL TO member :"+e.properties["cm:email"])}}else{f.parameters.to=k}f.parameters.subject=i;f.parameters.from=EMAIL_FROM;f.parameters.ignore_send_failure=true;f.parameters.template=companyhome.childrenByXPath(j)[0];var g=new Array();g.message=m;g.numeroDossier=d.name;g.siteShortName=l;var h=new Array();h.args=g;f.parameters.template_model=h;f.executeAsynchronously(d);logger.system.out("SEND EMAIL END")}function getDocument(){if(bpm_package!=null){for(var a=0;a<bpm_package.children.length;a++){return dossierIT=bpm_package.children[a]}}};